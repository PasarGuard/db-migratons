# Migration Configuration File Example
# Use this file with: uv run migrations/universal.py --config config.yml

# ============================================
# SOURCE CONFIGURATION
# ============================================

source:
  # Source database type: postgres, mysql, or sqlite
  type: "mysql"

  # For SQL dump files or SQLite databases, use 'path':
  path: "backup.sql"
  # Examples:
  # path: "mysql_dump.sql"        # MySQL SQL dump
  # path: "postgres_dump.sql"     # PostgreSQL SQL dump
  # path: "database.db"           # SQLite database file

  # For live database connections, use 'url' instead:
  # url: "mysql://user:pass@localhost:3306/sourcedb"
  # url: "postgresql://user:pass@localhost:5432/sourcedb"


# ============================================
# TARGET CONFIGURATION
# ============================================

target:
  # Target database type: postgres, mysql, or sqlite
  type: "postgres"

  # For live database connection (recommended), use 'url':
  url: "postgresql+asyncpg://user:password@localhost:5432/targetdb"
  # Examples:
  # url: "postgresql+asyncpg://admin:pass@localhost:5432/mydb"  # PostgreSQL
  # url: "mysql+pymysql://admin:pass@localhost:3306/mydb"       # MySQL

  # For SQLite file, use 'path':
  # path: "output.db"
  # or use 'url':
  # url: "sqlite:///output.db"


# ============================================
# OPTIONAL SETTINGS
# ============================================

# Tables to exclude from migration (optional)
exclude_tables:
  - admin_usage_logs
  - user_usage_logs
  - node_stats

# ============================================
# ENUM/STRING COLUMN DEFAULTS (Optional)
# ============================================
# Default values for text/varchar columns when value is NULL but column is NOT NULL
# Useful for enum-like string columns that need default values
# If not specified, uses PasarGuard defaults. Set to {} to disable all defaults.

enum_defaults:
  fingerprint: "none"
  security: "inbound_default"

# For custom schemas, specify your own enum defaults:
# enum_defaults:
#   status: "pending"
#   role: "user"
#   visibility: "public"

# To disable enum defaults entirely (use empty strings for NOT NULL text columns):
# enum_defaults: {}

# ============================================
# STRING TRUNCATION (Optional)
# ============================================
# Automatically truncate strings that exceed column max length
# Default: false (will fail migration if string is too long)
# Set to true to auto-truncate with warnings

truncate_strings: false

# When enabled:
# - Strings longer than VARCHAR(N) will be truncated to N characters
# - Warnings will be shown for which columns were truncated
# - Helps avoid "string data right truncation" errors
# When disabled (default):
# - Migration will fail if string exceeds max length
# - Safer option - you'll know about data quality issues

# ============================================
# TABLE ORDER (Optional - for custom schemas)
# ============================================
# Specify the order tables should be cleared and imported
# IMPORTANT: Order tables based on foreign key dependencies:
#   1. Tables with no foreign keys first
#   2. Tables that reference those tables next
#   3. Continue in dependency order
# If not specified, uses default PasarGuard schema order

# Default PasarGuard order (customize for your schema):
table_order:
  # System/configuration tables (no dependencies)
  - jwt
  - system
  - settings

  # Core tables
  - admins
  - core_configs
  - nodes
  - inbounds
  - groups

  # Association tables for many-to-many relationships
  - inbounds_groups_association

  # Dependent tables
  - hosts
  - user_templates
  - template_group_association

  # User tables (depends on groups, templates)
  - users
  - users_groups_association
  - next_plans

  # Usage and log tables (depends on users, nodes)
  - admin_usage_logs
  - user_usage_logs
  - notification_reminders
  - user_subscription_updates
  - node_user_usages
  - node_usages
  - node_stats

# Example for a custom blog schema:
# table_order:
#   - users            # No dependencies
#   - categories       # No dependencies
#   - posts            # References users
#   - tags             # No dependencies
#   - post_tags        # References posts and tags
#   - comments         # References posts and users
#   - likes            # References users and comments
